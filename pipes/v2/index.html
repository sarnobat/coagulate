<!DOCTYPE html>
<html>
<head>
<style>
.buttonize {
	//padding:20px;
	margin:25px;
	border-radius: 15px;
	box-shadow:
		inset 0 0 9px #222222, 
		10px 10px 14px #999999;// internal and external shadow
	background-color:#E6FAD2
}
</style>

<script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js">
<!-- <script src="jquery/jquery-1.9.1.js"> -->
</script>
<script>
$(document).ready(function(){
  $("button").click(function(){
  
  	refresh();
    $.getJSON("http://localhost:9099/helloworld/json?param1=" + encodeURIComponent(document.getElementById("urls").innerHTML),function(result){
      $.each(result, function(i, field){
        $("#items").append(i + " " + field + " ");
      });
    });
  });
});

function refresh() {

	var dirs1 = $("#urls").val().split(/\n/)
		.filter(function(item) { return !item.match(/.*fuse.*/);})
		.filter(function(item) { return item.match(/.*\/([^.]+)$/);})
		.map(function(item) { return item.replace(/.*\/(.+)/g,'$1') ;})
		.sort(CASE_INESENSITIVE)
		.map(function(item) { return "<button onclick='moveFile(this)' dir='"+btoa(item)+"' style='background-color:"+getColorForDir(item)+"'>" + item.substring(0,20) + "</button>";})
		//.join("<br>")
		;
		
	var dirs = "<table><tr><td>";
	var i = 0;
	dirs1.forEach(function(item){
		dirs += item + "<br>";
		if (i == 10) {
			i = 0;
			dirs += "</td><td>";
		}
		i++;
	});
	dirs += "</td></tr></table>";

	var html = $("#urls").val().split(/\n/)
		.filter(function(item) { return !item.match(/.*fuse.*/);})
		.filter(function(item) { return item.match(/.*\..*/);})
		.map(function(item) { return item.replace('/media/sarnobat','') ;})
		.map(function(item) { 
			
			var img2 = item.replace(/(.*\/)(.*)/g,'http://netgear.rohidekar.com:44452$1_thumbnails/$2.jpg');
			var img = "<img src='" + img2 + "' width=160>";
			var file = item.replace(/.*\/(.*)/g,'$1');
			return "<li class='buttonize' style='background-color:#FDFD96' file='"+btoa(unescape(encodeURIComponent(item)))+"'><div style='margin-left : 25px;margin-top : 25px;margin-right : 25px;margin-bottom : 25px;'><h3>"+ file +"</h3><br>" + img +"<br><br><textarea cols=100 rows=1>" + item + "</textarea><br>" +dirs+"</div></li>";
		});
	$("#items").append(html);
}


function moveFile(button) {

	var urlBase = "http://netgear.rohidekar.com:44451/cmsfs/";
	var destinationDirSimpleNameBase64 = button.getAttribute('dir');
	var destinationDirSimpleName = atob(destinationDirSimpleNameBase64);	
	var itemElement = button.parentElement.parentElement.parentElement.parentElement.parentElement.parentElement;
	var filePathBase64 = itemElement.getAttribute('file');

	itemElement.remove();

	$.getJSON(urlBase + "/moveBase64?filePath="+encodeURIComponent(filePathBase64) + "&destinationDirSimpleName=" + encodeURIComponent(destinationDirSimpleName),function() {
			
	}).fail(function(e) {
    alert( "error: " + e);
  });

}

function CASE_INESENSITIVE(a, b) {
    return a.toLowerCase().localeCompare(b.toLowerCase());
}

function getColorForDir(dirName) {                                                              
        var color = "";
        if (dirName == 'other' || dirName == 'divas') {
                color = 'pink';
        } else if (dirName.match(/Atletico/i) || dirName == 'brst') {
                color = 'red';
        }
        else if (dirName.match(/Liverpool/i)) {
                color = 'red';
        }
         else if (dirName == 'legs') {
                color = 'yellow';
        }  else if (dirName == 'navel') {
                color = 'lightpurple';
        }  else if (dirName == 'teen') {
                color = 'lavender';
        } else if (dirName.match(/productivity/i)) {
                color = 'yellow';
         } else if (dirName.match(/web/i)) {
                color = 'yellow';
        } else if (dirName.match(/soccer/i)) {
                color = 'green';
        } else if (dirName == 'ind') {
                color = 'orange';
        }
        return color;
}

</script>
</head>

<body>

<h3>Command</h3>
<textarea cols=30>
find $PWD/ -maxdepth 1
</textarea>

<h3>input : files</h3>
<textarea id="urls" cols=100 oninput="refresh()">
</textarea>
<br>

<table>
<tr>
<td><hr width=200px></td>
<td>
<div id="items"></div>
</td>
</tr>
<table>

</body>
</html>