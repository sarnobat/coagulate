<!DOCTYPE html>
<html>
<head>
<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js">
<script type="text/javascript" src="js/kb_shortcut.packed.js" ></script>
</script>
<script>


var urlBase = "http://netgear.rohidekar.com:4451/cmsfs/";
$(document).ready(function(){
	$.getJSON(urlBase + "/list?dirs=" + encodeURIComponent($("#locations").val()),function(response){
		var id = 0;
		for(var dirIndex in response.items) { 
			var filesInDir = response.items[dirIndex];
			if (filesInDir.length < 1) {
				continue;
			}
			var filesInDirSortedMap = Object.keys(filesInDir).sort();
			for (var sortedIndex in filesInDirSortedMap) {				
				++id;
				$('#items').append(createItemHtml(response, filesInDirSortedMap[sortedIndex], dirIndex, id));
			}
		}
	});
});


function createItemHtml(response, item, key, id)				
{	
	// height ensures buttons don't jump left and right between items for easier mass sorting. But it's not as nice to view
	var width = "250px";
	var height = "300px";
	{
		var toBeAppended = "";
		var httpUrl = response.items[key][item].httpUrl;
		{
			var lastModified = response.items[key][item].lastModified;
			{
				var res = item.match(/.*\.((jpe?g)|(png))/gi);			
				if (res !=null) {
					toBeAppended = '<img width="'+width+'" src="' + httpUrl + '"/>';
				}
			}
		}
		{
			var matchesVideo = item.match(/.*((mp4)|(webm))/gi);
			if (matchesVideo != null) {
				toBeAppended = '&nbsp;<video width="'+width+'" controls="" muted=""><source type="video/mp4" src="' +httpUrl+ '"/></video>';
			}
		}
	}	
	var idstring = "i" + id;
	
	var toBeAppended =	  "<tr id='" +idstring+"'><td><table><tr><td>"
		+ toBeAppended + "<td><td>"+createButtonsPanel(item, response, key, idstring)
		+ "</td></tr><tr><td colspan=2><textarea rows=4 style='width:" + width+"; word-wrap:break-word;'>" 
		+ decodeURIComponent(item)+"</textarea><br>"+lastModified
		+ "</td></tr></table></td></tr>";

	return toBeAppended;
}

function createButtonsPanel(item, response, key, idstring) {

	var buttons = "<table><tr><td>";							
	{
		var escaped = item.replace(/'/g, "&apos;");


		buttons += "<button onclick='moveFileToParent(\"" + escaped + "\",\""+idstring+"\")'>Wrong Category</button><br>";
		var subdirs = response.locations[key].dirs;
		var subdirsArray = Object.keys(subdirs).sort(function(a, b) {
			if (a.toLowerCase() < b.toLowerCase()) return -1;
			if (a.toLowerCase() > b.toLowerCase()) return 1;
			return 0;
		});
		{
			var buttonsAdded = 0;
			for (var dir in subdirsArray) {
				buttonsAdded++;
				if (buttonsAdded%15 == 0) {
					buttons += "</td><td>";
				}
				var dirName = subdirsArray[dir];
				{
					var color = getColorForDir(dirName);
					buttons += "<button onclick='moveFile(\"" + escaped + "\",\"" + dirName + "\",\""+idstring+"\")' style='background-color:"+color+"'>"+dirName+"</button><br>";
				}
			}
		}
	}
	buttons += "</td></tr></table>";
	return buttons;
}
							
function getColorForDir(dirName) {								
	var color = "";
	if (dirName == 'other' || dirName == 'divas') {
		color = 'pink';
	} else if (dirName.match(/Atletico/i) || dirName == 'brst') {
		color = 'red';
	} else if (dirName == 'legs') {
		color = 'yellow';
	}  else if (dirName == 'navel') {
		color = 'purple';
	}  else if (dirName == 'teen') {
		color = 'white';
	} else if (dirName.match(/soccer/i)) {
		color = 'green';
	} else if (dirName == 'ind') {
		color = 'orange';
		console.debug('found ind');
	}
	return color
}

function addslashes( str ) {
    return (str + '').replace(/[\\"']/g, '\\$&').replace(/\u0000/g, '\\0');
}


function moveFile(filePath, destinationDirSimpleName,id) {
	$.getJSON(urlBase + "/move?filePath="+encodeURIComponent(filePath) + "&destinationDirSimpleName=" + destinationDirSimpleName,function(response){
		$("#" + id).remove();
	});
}

function moveFileToParent(filePath, id) {
	$.getJSON(urlBase + "/moveToParent?filePath="+encodeURIComponent(filePath), function(response){
		$("#" + id).remove();
	});
}


</script>
</head>
<body>
<table id="items"></table>

Key bindings<br>
<textarea id="locations">
#/sarnobat.garagebandbroken/Windows/usb/Photos/2014-05-13 Los Angeles/originals
/e/Sridhar/Photos/camera phone photos/iPhone/sort_these
/e/Sridhar/Photos/camera phone photos/iPhone


#/Users/sarnobat/Desktop
#/Volumes/Large/Videos
#/Volumes/Unsorted/Videos

#/Users/sarnobat/Windows/misc/ind
#/Volumes/Unsorted/images
#/Users/sarnobat/Windows/misc/favorites

#/Volumes/Large/Videos/wwf

#/Volumes/Unsorted/Videos/Atletico
#/Volumes/Unsorted/Videos/wwf

</textarea>
<br><br>
<button>get urls</button>

</body>
</html>
